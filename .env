#!/bin/bash
PROJ_ROOT=$(dirname $0)
[[ $PROJ_ROOT == '.' ]] && PROJ_ROOT=$PWD
SITE_ROOT="$PROJ_ROOT/site"
SITE_WEBROOT_DEV="$SITE_ROOT/dev"
SITE_WEBROOT="$SITE_ROOT/public"

function site(){
  hugo -s $SITE_ROOT $*
}
function site-clean(){
  rm -rf $SITE_WEBROOT_DEV $SITE_WEBROOT > /dev/null
}
function site-dev(){
  site server -wDEF -d $SITE_WEBROOT_DEV -b http://localhost:1313 --navigateToChanged --cleanDestinationDir
}
function site-start(){
  site server
}
function site-build(){
  site
}

function site-build-docker(){
  docker run --rm -v $SITE_ROOT:/app yogendra/hugo:latest
}

function site-deploy(){
  [[ $# -eq 0 ]] && \
  echo "Usage: site-deploy user host path [port]" && \
  return

  local user=$1
  local host=$2
  local webroot=$3
  local port=${4:-22}

  webroot=$(echo $webroot | sed 's#/$##;s#$#/#')

  rsync -avz --delete -e "ssh -p $port" $SITE_WEBROOT/ $user@$host:$webroot
}

$*
