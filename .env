#!/bin/bash
PROJ_ROOT=$(dirname $0)
[[ $PROJ_ROOT == '.' ]] && PROJ_ROOT=$PWD
SITE_ROOT="$PROJ_ROOT"
SITE_WEBROOT="$SITE_ROOT/public"

function hexo(){
  node_modules/.bin/hexo $*
}
function site-clean(){
  hexo clean
}
function site-start(){
  site server
}
function site-build(){
  site build
}
function site-build-docker(){
  docker run --rm -v $(pwd):/src -w /src node:7 yarn install
  docker run --rm -v $(pwd):/src -w /src node:7 yarn build
}

function site-deploy(){
  [[ $# -eq 0 ]] && \
  echo "Usage: site-deploy user host path [port]" && \
  return

  local user=$1
  local host=$2
  local webroot=$3
  local port=${4:-22}

  webroot=$(echo $webroot | sed 's#/$##;s#$#/#')

  rsync -avz --delete -e "ssh -p $port" $SITE_WEBROOT/ $user@$host:$webroot
}

$*
