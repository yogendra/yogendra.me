language: node_js
node_js:
  - lts/dubnium
cache:
  npm: true
  directories:
    - node_modules
    - themes/tranquilpeak/node_modules
before_install:
  - openssl aes-256-cbc -K $encrypted_df2bd5da7d4c_key -iv $encrypted_df2bd5da7d4c_iv -in deploy_rsa.enc -out deploy_rsa -d
  - cp deploy_rsa ~/.ssh/deploy_rsa
  - chmod 400 ~/.ssh/deploy_rsa
  - echo -e "Host github.com\n\tHostName github.com\n\tUser git\n\tIdentityFile ~/.ssh/deploy_rsa\n" >> ~/.ssh/config
install:
  - npm install
script:
  - npm run build-prod-firebase
  - npm run build-prod-github
deploy:
  - provider: script
    script: npm run ci-deploy-firebase
    skip_cleanup: true
    on:
      branch: master
  - provider: script
    script: npm run ci-deploy-github
    skip_cleanup: true
    on:
      branch: master
notifications:
  email:
    on_failure: always
env:
  global:
    - secure: PBJhLXAGxlnJTQrPRSdEp+PTO2lDvCs3L7n07o0XnmaTOFrf7KleGw3wgGr/rMkZfmbuCMBpiwUe+VOcgwGefxHbG7xLVxqcIUopaq/uaMcHy/gYhFTuQJJFVFZIpy37Js6sRM8o8nYbOnWElQJt93SotMZFNmE3SNcxF9ijrCj+RWLd7g3rM31sl3fGGUYg0O/yLS/wvL+aYXeWGhase18c2wdV34MlXmoLE0C/+AiMTCpOqWMNLoBoDYLdETKeisY7CyKi8mEPhBOCMLkcUjW3FMIXJiCBzFk6WD4BTN8ybaMf2HzZc91G8QQs9CT0PExFXUY0tm4w2EOeL7VTtGDclIDawfzp/J0brVPhFwMNSXB1LX7z5zl4IEN3SzyUvCYlUn+7Dto2EsoOsE2n0wrdiIT06l1MdK/4umXdC7hCtcURN57ceni/dz4UZhiNPD+EPizdHeudin+rAjOfNGIKj0wlUwiMp7KhkJtSFFJtTqCv14TtACU8IV2FJ+XQYOYjk9nlP7xrleHmouLxfPR7cShYN7A2ku8aM18yteoxhLDEhKmm6FB6fjDTZzSJWnclejC5pqmkvSR3Ej0J5RMEhFRq+zJccVWwvrNLjr6Hx0bkNBeA+9N/sROJLhV7seNVIWWjc/OREdmt8Jz1BRkqczzqtQ2AJT9owN0fYoM=
    - secure: IwSkVt5I8xddhLFH+/2x2Ox601g746MDagAFM4xpsEIQ3c1dfzsKCGhOr1pH+h7JQGEqpHItB2SYErUujSL88efVr7azgKqFoD7+maUyxaEkvZkl0dKAQfRloumjWMHZWHFkrhvSR7vMIICz8Ga4Gtg9jbxPThZODNLbfpuCFsrOWtWc2ZMsBwKWERTpYtcab1LcieVN31ymG/qceVy5b9APDksbCV43RY+H+QmA9mwdVmP7Kdc9J1MtUgOQaqG/l8IDqzEUiURtJx7T8kQuB7d4GRza/FNMk/YCfbAX7fhxYUY0oieXHprIlUY3abtjr8cI0VqzDNbgCHX1t1oVSOR1njETnHoCWBrAwjYebpayLRw9dbp0v4zOPYvGbR7IcsahaHAYrUyWXYFJkRPrwfqIuO/WqTCMl0ygbHgxB9g9Nz3vwOYxCCL8O/pcKlMj2DnskQ9l9ahSU7B5PmA57jlz5e50aBNjmKVSdeuSjWR6TxvHn3SrfDFmP+A3q6Fa6Pa0uxCmvTKQWCvqZyDWETxmoDWf1m5cAbspHqa7hZq48G5o84HjD9fvv82TYlB/u9+LVlAVDxY3Vg4mHTdFHWX+YkWMI0/NeeO2x3Eohte/in7Nd1EG4+EejrgDE9RQdmOkPpuWBOxYONZmdhLAK7sLIBLeVP2NPVluV1rdgik=
